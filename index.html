<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Interview Scraper UI</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: 'Fira Code', monospace;
    }
    .loader {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #facc15; /* yellow */
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body class="bg-neutral-900 text-white">

  <div class="container mx-auto px-4 py-8 flex flex-col items-center">
    <h1 class="text-3xl font-bold mb-6 text-yellow-400 text-center">Interview Question Scraper</h1>

    <div class="w-full max-w-2xl">
      <label class="block mb-2 text-white">Select Platform</label>
      <select id="platform" class="w-full p-2 mb-4 rounded bg-neutral-800 text-white border border-yellow-400">
        <option value="ambitionbox" selected>AmbitionBox</option>
      </select>

      <label class="block mb-2 text-white">Enter Role</label>
      <input type="text" id="role" placeholder="e.g., backend developer" class="w-full p-2 mb-4 rounded bg-neutral-800 text-white border border-yellow-400">

      <button id="generateBtn" class="bg-yellow-400 text-black w-full px-6 py-2 rounded font-bold hover:bg-yellow-300 transition">Generate Q&A</button>
    </div>

    <div id="loader" class="loader mt-6 hidden"></div>

    <div id="toast" class="fixed bottom-5 right-5 bg-green-600 text-white px-4 py-2 rounded hidden"></div>

    <div id="qaContainer" class="mt-8 w-full max-w-2xl flex flex-col gap-4"></div>
  </div>

  <script>
    const btn = document.getElementById('generateBtn');
    const loader = document.getElementById('loader');
    const toast = document.getElementById('toast');
    const qaContainer = document.getElementById('qaContainer');
    const roleInput = document.getElementById('role');

    btn.addEventListener('click', async () => {
      let role = roleInput.value.trim().toLowerCase().replace(/\s+/g, '-');

      if (!role) {
        showToast('Please enter a role name!', true);
        return;
      }

      loader.classList.remove('hidden');
      qaContainer.innerHTML = '';

      try {
        const res = await fetch(`http://192.168.1.3:3000/scrape/${role}`);
        const data = await res.json();

        if (data.error) {
          showToast(`Error: ${data.error}`, true);
        } else {
          showToast('Questions loaded successfully!');
          data.data.forEach((item, index) => {
            const card = createQACard(item.question, item.answer, index + 1);
            qaContainer.appendChild(card);
          });

          // Scroll to top after loading
          window.scrollTo({ top: 0, behavior: 'smooth' });
        }
      } catch (error) {
        showToast(`Fetch error: ${error.message}`, true);
      } finally {
        loader.classList.add('hidden');
      }
    });

    function createQACard(question, answer, number) {
      const card = document.createElement('div');
      card.className = "bg-neutral-800 text-white p-4 rounded-lg border border-yellow-400 shadow transition";

      const heading = document.createElement('h2');
      heading.className = "text-yellow-400 font-bold mb-2";
      heading.textContent = `${number}. Question:`;

      const questionText = document.createElement('p');
      questionText.className = "mb-3";
      questionText.textContent = question;

      const answerHeading = document.createElement('h3');
      answerHeading.className = "text-yellow-400 font-bold mb-1";
      answerHeading.textContent = "Answer:";

      const answerText = document.createElement('p');
      answerText.textContent = answer;

      card.appendChild(heading);
      card.appendChild(questionText);
      card.appendChild(answerHeading);
      card.appendChild(answerText);

      return card;
    }

    function showToast(message, isError = false) {
      toast.textContent = message;
      toast.className = `fixed bottom-5 right-5 px-4 py-2 rounded ${isError ? 'bg-red-600' : 'bg-green-600'} text-white`;
      toast.classList.remove('hidden');

      setTimeout(() => {
        toast.classList.add('hidden');
      }, 3000);
    }
  </script>
</body>
</html>
